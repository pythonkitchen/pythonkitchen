<!doctype html>
<html lang="EN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset='UTF-8'>
  <meta name='keywords' content='python, machine learning'>
  <meta name='description' content='Educating programmers about interesting, 
    crucial topics. Articles are intended to break down tough subjects, while 
    being friendly to beginners'>
  <meta name='subject' content='Python / Machine Learning articles'>
  <meta name='copyright' content='pythonkitchen.com'>
  <meta name='language' content='EN'>
  <meta name='robots' content='index,follow'>
  <meta name='revised' content='Wednesday, August 30thth, 2023, 13:30 pm'>
  <meta name='abstract' content=''>
  <meta name='topic' content='python'>
  <meta name='summary' content=''>
  <meta name='Classification' content='Education'>
  <meta name='author' content='PythonKitchen, email@hotmail.com'>
  <meta name='designer' content=''>
  <meta name='reply-to' content='email@hotmail.com'>
  <meta name='owner' content=''>
  <meta name='url' content='https://www.pythonkitchen.com'>
  <meta name='identifier-URL' content='https://www.pythonkitchen.com'>
  <meta name='directory' content='submission'>
  
  
  <meta name='target' content='all'>
  <meta name='HandheldFriendly' content='True'>
  <meta name='MobileOptimized' content='320'>
  <meta name='date' content='2023-11-23 10:35:00'>
  <meta name='DC.title' content='Quality Python articles'>
  <meta name='ResourceLoaderDynamicStyles' content=''>
  <meta name='medium' content='blog'>
  <!-- <meta name='verify-v1' content='dV1r/ZJJdDEI++fKJ6iDEl6o+TMNtSu0kv18ONeqM0I='>
  <meta name='y_key' content='1e39c508e0d87750'> -->
  
  <meta http-equiv='Expires' content='0'>
  <meta http-equiv='Pragma' content='no-cache'>
  <meta http-equiv='Cache-Control' content='no-cache'>
  <meta http-equiv='imagetoolbar' content='no'>
  <meta http-equiv='x-dns-prefetch-control' content='off'>

  
  <meta name='og:type' content='blog'>
  <meta name='og:site_name' content='PythonKitchen'>
  <meta name='og:description' content='Educating programmers about interesting, 
  crucial topics. Articles are intended to break down tough subjects, while 
  being friendly to beginners'>

  <link rel="shortcut icon" href="/assets/logo.png" /> 
  
  <script src="https://cdn.tailwindcss.com"></script>
  <style>

  </style>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4895581427484601" crossorigin="anonymous"></script>
  
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-161612035-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161612035-3');
</script>

<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "ejj5ivpuup");
</script>

  <meta name='Chat with your own data/text files using chatGPT and LangChain' content=''>
  <meta name='category' content='data science'>
  <meta name='coverage' content='Worldwide'>
  <meta name='distribution' content='Global'>
  <meta name='rating' content='General'>
  <meta name='revisit-after' content='1 year'>
  <meta name='subtitle' content='Chat with your own data/text files using chatGPT and LangChain'>
  <meta name='pageKey' content='chat-own-data-chatgpt-langchain'>
  <meta name='og:title' content='Chat with your own data/text files using chatGPT and LangChain'>
  <meta name='og:url' content='https://www.pythonkitchen.com/chat-own-data-chatgpt-langchain'>

  <title>Chat with your own data/text files using chatGPT and LangChain</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

<!-- and it's easy to individually load additional languages -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/python.min.js"></script>

<link rel="stylesheet" href="/css/post.css"> 


</head>
<body class="bg-gray-50">

<nav class="bg-white border-gray-200 dark:bg-gray-900">
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
      <a href="/" class="flex items-center">
          <img src="/assets/logo.png" class="h-8 mr-3" alt="PythonKitchen Logo" 
            style="width: 50px !important; height: 50px !important;"/>
          <span class="self-center text-2xl font-semibold whitespace-nowrap dark:text-white">PythonKitchen</span>
      </a>
      <button data-collapse-toggle="navbar-default" type="button" class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600" aria-controls="navbar-default" aria-expanded="false">
          <span class="sr-only">Open main menu</span>
          <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
              <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"/>
          </svg>
      </button>
      <div class="hidden w-full md:block md:w-auto" id="navbar-default">
        <ul class="font-medium flex flex-col p-4 md:p-0 mt-4 border border-gray-100 rounded-lg bg-gray-50 md:flex-row md:space-x-8 md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">
          <li>
            <a href="/" 
            class="block py-2 pl-3 pr-4 text-white bg-blue-700 rounded md:bg-transparent md:text-blue-700 md:p-0 dark:text-white md:dark:text-blue-500" aria-current="page">
            Home</a>
          </li>
          <li>
            <a href="https://docs.google.com/forms/d/e/1FAIpQLSdnP_IW4nK95hv-eBDIlxHb5E5DeOniFWBi9YmxlHZARLJDAQ/viewform" class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">
              Write</a>
          </li>
          <li>
            <a href="https://forms.gle/gf1p1Aitw9M9m8Zy5" class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">
              Contact</a>
          </li>
          <!-- <li>
            <a href="#" class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">Pricing</a>
          </li>
          <li>
            <a href="#" class="block py-2 pl-3 pr-4 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent">Contact</a>
          </li> -->
        </ul>
      </div>
    </div>
  </nav>
  
  

<div class="p-8">

</div>

<div class="flex flex-row space-x-2">
    <div class="basis-3/4">
        <div class="p-8 pl-12">
            <div class="ml-2">
                <div class=" bg-white rounded-lg shadow-lg" style="padding: 4vw !important;">
                    <p class="text-3xl" style="font-weight: 600;">Chat with your own data/text files using chatGPT and LangChain</p>
                    <br>
                    <div class="flex items-center gap-x-4 text-xs">
                        <time datetime="2023-11-23 10:35:00" class="text-gray-500">November 23, 2023</time>
                        
                        <a href="#" class="relative z-10 rounded-full bg-gray-50 px-3 py-1.5 font-medium text-gray-600 hover:bg-gray-100">
                            data science
                        </a>
                        
                        <a href="#" class="relative z-10 rounded-full bg-gray-50 px-3 py-1.5 font-medium text-gray-600 hover:bg-gray-100">
                            machine learning
                        </a>
                        
                    </div>
                    
                        <div class="relative mt-8 flex items-center gap-x-4">
                            <img src="https://github.com/Abdur-rahmaanJ.png?size=40" alt="" class="h-10 w-10 rounded-full bg-gray-50">
                            <div class="text-sm leading-6">
                            <p class="font-semibold text-gray-900">
                                <a href='https://www.linkedin.com/in/appinv/'>
                                <span class="absolute inset-0"></span>
                                Abdur-Rahmaan Janhangeer
                                </a>
                            </p>
                            <p class="text-gray-600">Chef</p>
                            </div>
                        </div>
                    
                    <br>
                    <article>
                        <p>There are many different approaches to chatting with your own data.
One way is to upload your PDF to the OpenAi chatGPT cloud.
This comes with several limitations such as data being deleted or umm the risk of a not smart chatGPT leaking it.</p>
<p>Now, you can also download a model from somewhere. 
And you need to find a good one.
And it will probably not be as good as chatGPT.
So, to benefit from the advantage of chatGPT with local data, <a href="">LangChain</a> presents an interesting option. 
We, however, need a vector store.</p>
<h2>What is a vector store?</h2>
<p>A vector store stores data as data encodings.
This allows us to plug our own data in chatGPT.
It augments the contextual awareness of chatGPT.
If you asks about &ldquo;Mauritius tourist activities&rdquo;, it might give some response.
If you give it more information, the response will be more detailed.
You need to convert your data into vector embeddings and store it in a vector database.
You can use Redis, PineCone (A SaaS offering) or <a href="https://python.langchain.com/docs/integrations/vectorstores/chroma">ChromaDB</a> as vector databases among others.
Fortunately, <a href="https://python.langchain.com/">LangChain</a> helps us a lot in connecting a vector store for use in chatGPT.</p>
<p>Please read this before to understand more about vector databases: <a href="/LangChain-understand-production-codebases/">Understand langChain to Quickly Get Started with Production Codebases</a></p>
<h2>The code</h2>
<p>You need to install those:</p>
<pre><code>pip install langchain openai chromadb==0.4.15 tiktoken unstructured
</code></pre>
<p>Then create a directory called <code>data/</code>.</p>
<p>Then add your files in the data folder.</p>
<p>Then create a file called chat.py.</p>
<p>Your directory looks like this</p>
<pre><code>./
data/
    friends.txt
    bugs.txt
chat.py
</code></pre>
<p>You can add whatever info you want in the data folder.</p>
<p>You can add pdfs also.</p>
<p>Then paste:</p>
<pre><code class="language-python">import os
import sys

from langchain.chains import ConversationalRetrievalChain
from langchain.chat_models import ChatOpenAI
from langchain.document_loaders import DirectoryLoader
from langchain.indexes import VectorstoreIndexCreator
from langchain.indexes.vectorstore import VectorStoreIndexWrapper
from langchain.vectorstores import Chroma
from langchain.embeddings.sentence_transformer import SentenceTransformerEmbeddings

os.environ[&quot;OPENAI_API_KEY&quot;] = &quot;sk-myopenaikey&quot;

# Enable to save to disk &amp; reuse the model (for repeated queries on the same data)
PERSIST = False
query = None

embedding_function = SentenceTransformerEmbeddings(model_name=&quot;all-MiniLM-L6-v2&quot;)


if PERSIST and os.path.exists(&quot;persist&quot;):
  print(&quot;Reusing index...\n&quot;)
  vectorstore = Chroma(persist_directory=&quot;persist&quot;, embedding_function=embedding_function)
  index = VectorStoreIndexWrapper(vectorstore=vectorstore)
else:
  # loader = TextLoader(&quot;data/data.txt&quot;) # Use this line if you only need data.txt
  loader = DirectoryLoader(&quot;exp-data/&quot;) # Also supports glob=&quot;&lt;pattern&gt;&quot;
  if PERSIST:
    index = VectorstoreIndexCreator(vectorstore_kwargs={&quot;persist_directory&quot;:&quot;persist&quot;}).from_loaders([loader])
  else:
    index = VectorstoreIndexCreator().from_loaders([loader])

chain = ConversationalRetrievalChain.from_llm(
  llm=ChatOpenAI(model=&quot;gpt-3.5-turbo&quot;),
  retriever=index.vectorstore.as_retriever(search_kwargs={&quot;k&quot;: 1}),
)

chat_history = [] # preserve context
while True:
  if not query:
    query = input(&quot;Prompt &gt; &quot;)
  if query in ['quit', 'q', 'exit']:
    sys.exit()
  result = chain({&quot;question&quot;: query, &quot;chat_history&quot;: chat_history})
  print(result['answer'],end=&quot;\n\n&quot;)

  chat_history.append((query, result['answer']))
  query = None
</code></pre>
<p>The persist part is if you don&rsquo;t want to load it in the db each time.</p>
<h2>Notes</h2>
<p>If you have errors like:</p>
<pre><code>Traceback (most recent call last):
  File &quot;&quot;, line 34, in &lt;module&gt;
    index = VectorstoreIndexCreator().from_loaders([loader])
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;&quot;, line 82, in from_loaders
    return self.from_documents(docs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;&quot;, line 87, in from_documents
    vectorstore = self.vectorstore_cls.from_documents(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;site-packages/langchain/vectorstores/chroma.py&quot;, line 684, in from_documents
    return cls.from_texts(
           ^^^^^^^^^^^^^^^
  File &quot;site-packages/langchain/vectorstores/chroma.py&quot;, line 620, in from_texts
    chroma_collection = cls(
                        ^^^^
  File &quot;site-packages/langchain/vectorstores/chroma.py&quot;, line 125, in __init__
    self._collection = self._client.get_or_create_collection(
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;site-packages/chromadb/api/client.py&quot;, line 226, in get_or_create_collection
    return self._server.get_or_create_collection(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;site-packages/chromadb/telemetry/opentelemetry/__init__.py&quot;, line 127, in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File &quot;site-packages/chromadb/api/segment.py&quot;, line 216, in get_or_create_collection
    return self.create_collection(  # type: ignore
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;site-packages/chromadb/telemetry/opentelemetry/__init__.py&quot;, line 127, in wrapper
    return f(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^
  File &quot;site-packages/chromadb/api/segment.py&quot;, line 190, in create_collection
    return Collection(
           ^^^^^^^^^^^
  File &quot;site-packages/chromadb/api/models/Collection.py&quot;, line 85, in __init__
    validate_embedding_function(embedding_function)
  File &quot;site-packages/chromadb/api/types.py&quot;, line 210, in validate_embedding_function
    raise ValueError(
ValueError: Expected EmbeddingFunction.__call__ to have the following signature: odict_keys(['self', 'input']), got odict_keys(['self', 'args', 'kwargs'])
Please see https://docs.trychroma.com/embeddings for details of the EmbeddingFunction interface.
Please note the recent change to the EmbeddingFunction interface: https://docs.trychroma.com/migration#migration-to-0416---november-7-2023 
</code></pre>
<p>The solution is probably to pin an older version of chromadb as we did above.</p>
<h2>Nice resources</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=9AXP7tCI9PI">Techlead video explanation</a></li>
<li><a href="https://github.com/techleadhd/chatgpt-retrieval">Techlead faulty code (Which I fixed in this post)</a></li>
<li><a href="https://github.com/rubentak/Langchain/blob/main/notebooks/Langchain_doc_chroma.ipynb">LangChain chroma notebook</a></li>
</ul>

                        <script src="https://utteranc.es/client.js"
        repo="pythonkitchen/blog-comments"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>
                    </article>
                
                  </div>
                
            </div>
        </div>
        
    </div>
    <div class="basis-1/4">
        <div class="p-8 pl-12">
            <div class="ml-2">
                <div class=" bg-white rounded-lg shadow-lg" style="padding: 5px">
                    <article>
                        <a target="_blank" href="https://packt.link/3g4ol">
                            <img src="/assets/packt.jpg" style="width: 100% !important">
                        </a>
                    </article>
                    </div>
                    
                    
            </div>
        </div>

        
    </div>
  </div>




<script>hljs.highlightAll();</script>




</body>
</html>